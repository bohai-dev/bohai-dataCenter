<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bohai.dataCenter.persistence.ReportDepMapper" >
  <resultMap id="BaseResultMap" type="com.bohai.dataCenter.entity.ReportDep" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 07 13:57:30 CST 2017.
    -->
    <result column="DEP_NAME" property="depName" jdbcType="VARCHAR" />
    <result column="INTEREST" property="interest" jdbcType="DECIMAL" />
    <result column="EXCHANGE_RETURN" property="exchangeReturn" jdbcType="DECIMAL" />
    <result column="EXCHANGE_RETURN_TICKTIX" property="exchangeReturnTicktix" jdbcType="DECIMAL" />
    <result column="SPECIAL_INTEREST" property="specialInterest" jdbcType="DECIMAL" />
    <result column="SPECIAL_EXCHANGE_TICKTIX" property="specialExchangeTicktix" jdbcType="DECIMAL" />
    <result column="COMMISSION" property="commission" jdbcType="DECIMAL" />
    <result column="MEDIATOR_COMMISSION" property="mediatorCommission" jdbcType="DECIMAL" />
    <result column="MARKETER_PROFIT" property="marketerProfit" jdbcType="DECIMAL" />
    <result column="DEP_PROFIT" property="depProfit" jdbcType="DECIMAL" />
    <result column="MONTH" property="month" jdbcType="CHAR" />
     <result column="all_PROFIT" property="allProfit" jdbcType="DECIMAL" />
  </resultMap>
  
  <select id="selectByMonth" resultMap="BaseResultMap" parameterType="com.bohai.dataCenter.vo.QueryDepProfitPieChartParamVO">
    select * from T_REPORT_DEP
    where 
    <if test="month != null and month != ''">
        MONTH = #{month}
    </if>
    <if test="month == null or month == ''">
        MONTH = (select max(MONTH) from T_REPORT_DEP)
    </if>
  </select>
  
  <!--  <select id="selectByDep" resultMap="BaseResultMap" parameterType="com.bohai.dataCenter.vo.QueryDepProfitBarChartParamVO">
   select b.month,nvl(a.DEP_PROFIT,0) as dep_profit, nvl(a.INTEREST+a.EXCHANGE_RETURN_TICKTIX+a.COMMISSION,0) as allProfit from T_REPORT_DEP a right join (SELECT distinct TYEAR||'-'||TMONTH as month from T_TRADING_DATE) b 
   on a.month = b.month 

    <if test="depName != null and depName != ''">
        AND  a.DEP_NAME= #{depName}
    </if>
    order by b.month
  </select> -->
   <select id="selectByDep" resultMap="BaseResultMap" parameterType="com.bohai.dataCenter.vo.QueryDepProfitBarChartParamVO">
   select a.month,nvl(a.DEP_PROFIT,0) as dep_profit, nvl(a.INTEREST+a.EXCHANGE_RETURN_TICKTIX+a.COMMISSION,0) as allProfit from T_REPORT_DEP a 
   where
     <if test=" year!= null and year!= ''">
        a.month like #{year}||'%'

    </if>
    <if test="depName != null and depName != ''">
        and a.DEP_NAME= #{depName}
    </if>
   
  </select>
  
  
</mapper>